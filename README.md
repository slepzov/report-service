# Сервис генерации отчетов

## Описание 
Скрипт-клиент отправляет сообщения на генерацию отчетов в RabbitMQ в очередь task_report. Сервис report-service получает сообщения из данной очереди, проверяет наличие в кеше данных по каждому телефону из списка в присланной задаче.
Если данные по телефону не найдены в кэше или истек ttl, то затем для всех таких телефонов данные берутся из data.json, обрабатываются, записываются в кэш и дополнительный файл. При перезапуске сервиса кэш восстанавливаеися из данного файла.
Для кэширования данных используется словарь python. После генерации отправляется сообщение с отчетом в RabbitMQ в очередь ready_report.

## Как запустить:

1. Склонируйте репозиторий на свой ПК
2. Поместите файл data.json в директорию report-service/src/data/ и дать файлу права на чтение `chmod +r report-service/src/data/data.json`
3. Находясь в директории report-service/ выполните команду `docker compose up` 
4. При успешном запуске в консоле появится сообщение "event": "Consumer connected and ready to consume messages."
5. Для работы скрипт-клиента из директории report-service выполните команду `poetry install`, затем `poetry shell`
6. В скрипте report-service/src/scripts/producer.py можно в массиве MESSAGES указать дополнительные входные данные для отправки сообщений в RabbitMQ
7. Находясь в директории report-service/ выполните команду `python3 src/scripts/producer.py` для отправки сообщений с запросами на генерацию отчетов
8. Проверить сообщения с готовыми отчетами можно в RabbitMQ, перейдя в браузере по адресу http://localhost:15672/, логин/пароль: guest/guest 


## Статистика быстродействия сервиса:

- При холодном кэше время формирования отчета от 14 до 15 секунд:
```
'total_duration': 14.822753429412842
'total_duration': 15.183628797531128
'total_duration': 14.430518627166748
'total_duration': 14.900131940841675
'total_duration': 14.684915781021118
'total_duration': 14.359669923782349
'total_duration': 14.315485000610352
'total_duration': 14.681304454803467
'total_duration': 14.789857149124146
'total_duration': 14.593908309936523
```

- При прогретом кэше вреия формирования отчета менее секунды:
```
'total_duration': 0.00012040138244628906
'total_duration': 0.0001354217529296875
'total_duration': 9.870529174804688e-05
'total_duration': 5.602836608886719e-05
'total_duration': 4.935264587402344e-05
'total_duration': 0.00010514259338378906
'total_duration': 9.465217590332031e-05
'total_duration': 0.0005412101745605469
'total_duration': 0.00020003318786621094
'total_duration': 0.00016117095947265625
```
